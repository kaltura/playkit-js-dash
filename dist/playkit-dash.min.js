!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("shaka-player"),require("playkit-js")):"function"==typeof define&&define.amd?define(["shaka-player","playkit-js"],t):"object"==typeof exports?exports.PlaykitJsDash=t(require("shaka-player"),require("playkit-js")):e.PlaykitJsDash=t(e.shaka,e.Playkit)}(this,function(e,t){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t,a,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,a,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),u=a(1),c=function(e){return e&&e.__esModule?e:{default:e}}(u),l=a(2),d=function(e){function t(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),t._logger.debug("Creating adapter. Shaka version: "+c.default.Player.version);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,n));return o._shaka=new c.default.Player(e),o._shaka.configure(n),o._shaka.setTextTrackVisibility(!0),o._addBindings(),o}return n(t,e),s(t,null,[{key:"createAdapter",value:function(e,t,a){var r={};return l.Utils.Object.hasPropertyPath(a,"playback.options.html5.dash")&&(r=a.playback.options.html5.dash),new this(e,t,r)}},{key:"canPlayType",value:function(e){var a="string"==typeof e&&e.toLowerCase()===t._dashMimeType;return t._logger.debug("canPlayType result for mimeType: "+e+" is "+a.toString()),a}},{key:"isSupported",value:function(){c.default.polyfill.installAll();var e=c.default.Player.isBrowserSupported();return t._logger.debug("isSupported:"+e),e}}]),s(t,[{key:"_addBindings",value:function(){this._shaka.addEventListener("adaptation",this._onAdaptation.bind(this)),this._shaka.addEventListener("error",this._onError.bind(this))}},{key:"_removeBindings",value:function(){this._shaka.removeEventListener("adaptation",this._onAdaptation),this._shaka.removeEventListener("error",this._onError)}},{key:"load",value:function(e){var a=this;return this._loadPromise||(this._loadPromise=new Promise(function(r,i){a._sourceObj&&a._sourceObj.url&&(a._trigger(l.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:a.isAdaptiveBitrateEnabled()?"auto":"manual"}),a._shaka.load(a._sourceObj.url,e).then(function(){var e={tracks:a._getParsedTracks()};t._logger.debug("The source has been loaded successfully"),r(e)}).catch(function(e){i(e),a._onError(e)}))})),this._loadPromise}},{key:"destroy",value:function(){t._logger.debug("destroy"),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this._loadPromise=null,this._sourceObj=null,this._removeBindings(),this._shaka.destroy()}},{key:"_getVideoTracks",value:function(){var e=this._shaka.getVariantTracks(),t=e.filter(function(e){return e.active})[0];return e.filter(function(e){return e.audioId===t.audioId})}},{key:"_getAudioTracks",value:function(){var e=this._shaka.getVariantTracks(),t=e.filter(function(e){return e.active})[0];return e.filter(function(e){return e.videoId===t.videoId})}},{key:"_getParsedTracks",value:function(){var e=this._getParsedVideoTracks(),t=this._getParsedAudioTracks(),a=this._getParsedTextTracks();return e.concat(t).concat(a)}},{key:"_getParsedVideoTracks",value:function(){var e=this._getVideoTracks(),t=[];if(e)for(var a=0;a<e.length;a++){var r={id:e[a].id,bandwidth:e[a].bandwidth,width:e[a].width,height:e[a].height,active:e[a].active,label:e[a].label,index:a};t.push(new l.VideoTrack(r))}return t}},{key:"_getParsedAudioTracks",value:function(){var e=this._getAudioTracks(),t=[];if(e)for(var a=0;a<e.length;a++){var r={id:e[a].id,active:e[a].active,label:e[a].label,language:e[a].language,index:a};t.push(new l.AudioTrack(r))}return t}},{key:"_getParsedTextTracks",value:function(){var e=this._shaka.getTextTracks(),t=[];if(e)for(var a=0;a<e.length;a++){var r={kind:e[a].kind?e[a].kind+"s":"",active:e[a].active,label:e[a].label,language:e[a].language,index:a};t.push(new l.TextTrack(r))}return t}},{key:"selectVideoTrack",value:function(e){var t=this._getVideoTracks();if(e instanceof l.VideoTrack&&t){var a=t[e.index];a&&(this.isAdaptiveBitrateEnabled()&&(this._shaka.configure({abr:{enabled:!1}}),this._trigger(l.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:"manual"})),a.active||(this._shaka.selectVariantTrack(t[e.index],!0),this._onTrackChanged(e)))}}},{key:"selectAudioTrack",value:function(e){e instanceof l.AudioTrack&&!e.active&&(this._shaka.selectAudioLanguage(e.language),this._onTrackChanged(e))}},{key:"selectTextTrack",value:function(e){e instanceof l.TextTrack&&!e.active&&("subtitles"===e.kind||"captions"===e.kind)&&(this._shaka.selectTextLanguage(e.language),this._shaka.setTextTrackVisibility(!0),this._onTrackChanged(e))}},{key:"hideTextTrack",value:function(){this._shaka.setTextTrackVisibility(!1)}},{key:"enableAdaptiveBitrate",value:function(){this.isAdaptiveBitrateEnabled()||(this._trigger(l.BaseMediaSourceAdapter.CustomEvents.ABR_MODE_CHANGED,{mode:"auto"}),this._shaka.configure({abr:{enabled:!0}}))}},{key:"isAdaptiveBitrateEnabled",value:function(){return this._shaka.getConfiguration().abr.enabled}},{key:"_onAdaptation",value:function(){var e=this._getParsedVideoTracks().filter(function(e){return e.active})[0];this._onTrackChanged(e)}},{key:"_onError",value:function(e){t._logger.error(e)}},{key:"src",get:function(){return this._loadPromise&&this._sourceObj?this._sourceObj.url:""}}]),t}(l.BaseMediaSourceAdapter);d.id="DashAdapter",d._logger=l.BaseMediaSourceAdapter.getLogger(d.id),d._dashMimeType="application/dash+xml",t.default=d,d.isSupported()&&(0,l.registerMediaSourceAdapter)(d)},function(t,a){t.exports=e},function(e,a){e.exports=t}])});
//# sourceMappingURL=playkit-dash.min.js.map